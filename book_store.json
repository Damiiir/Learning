// Создание базы данных book_store
use book_store

// Создание коллекций Economics, Non-fiction, Popular_Science
db.createCollection("Economics")
db.createCollection("Non-fiction")
db.createCollection("Popular_Science")

// Единичное добавление данных в коллекцию Economics
db.Economics.insertOne ({
    "author": "Сергей Гуриев",
    "name of book": "Мифы экономики. Заблуждения и стереотипы",
    "year of issue": 2006
})

// Множественное добавление данных в коллекцию Non-fiction
db.Non-fiction.insertMany ([
{
    "author": "Cергей Довлатов",
    "name of book": "Чемодан",
    "year of issue": 1986
},
{
    "author": "Cергей Довлатов",
    "name of book": "Зона.Записки надзирателя",
    "year of issue": 1982
}
])

// Множественное добавление данных в коллекцию Popular_Science
db.Popular_Science.insertMany([
{
    "author": "Манфред Шпитцер",
    "name of book": "Антимозг",
    "year of issue": 2013
},
{
    "author": "Марк Медовник",
    "name of book": "Жидкости. Прекрасные и опасные субстанции, которые нас окружают",
    "year of issue": 2018
},
{
    "author": "Карл Саган",
    "name of book": "Мирб полный демонов. Наука - как свеча во тьме",
    "year of issue": 1995
}
])

// Выборка данных из коллекции Popular_Science с годом издания 2013
db.Popular_Science.find({year of issue: 2013})

// Выборка данных из коллекции Popular_Science с годом издания позднее 2013
db.Popular_Science.find({year of issue: {$gt: 2013}})

// Выборка данных из коллекции Popular_Science с годом издания 2013 или автором Марк Медовник
db.Popular_Science.find({$or: [{year of issue: 2013}, {author: "Марк Медовник"}]})

/* Выборка данных из коллекции Popular_Science с ограничением в 2 книги 
и сортировкой по возрастанию года выпуска */
db.Popular_Science.find().limit(2).sort(year of issue: 1)

// Обновление года выпуска книги в коллекции Non-fiction
db.Non-fiction.updateOne({year of issue: 1986}, {$set: {year of issue: 1985}})

// Удаление данных из коллекции Popular_Science c названием книги Антимозг или годом выпуска 2010
db.users.deleteOne({$or:[{name of book: "Антимозг"}, {year of issue: 2010}]})

// Объединение запросов в коллекции Economics
db.Economics.bulkWrite([
    {
        insertOne: {"document": {author: "Ха Джун Чанг", name: "Как устроена экономика", year of issue: 2015}}
    },
    {
        updateOne: {filter: {year of issue: 2006}
        update: {$set: {year of issue: 2005}}}
    }
])

// Поиск на совпадение в тексте коллекции Popular_SCience
db.Popular_Science.createIndex({author: "text", name: "text"})
db.Popular_Science.find({$text: {$search: "Мир"}})
